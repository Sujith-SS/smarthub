<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Address List</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 30px;
        }
        h2 {
            color: #fd7e14; /* Orange color for headings */
        }
        .btn-primary {
            background-color: #fd7e14; /* Orange color */
            border-color: #fd7e14;
        }
        .btn-danger {
            background-color: #dc3545; /* Red color for delete button */
            border-color: #dc3545;
        }
        .btn-warning {
            background-color: #ffc107; /* Yellow color for edit button */
            border-color: #ffc107;
        }

        body {
            background-color: #f8f9fa;
        }
        .container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 30px;
        }
        h2 {
            color: #fd7e14; /* Orange color for headings */
        }
        .btn {
            width: 120px; /* Fixed width for all buttons */
            margin-right: 5px
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <!-- Breadcrumbs -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
                <li class="breadcrumb-item"><a href="{% url 'user_profile' %}">Profile</a></li>
                <li class="breadcrumb-item active" aria-current="page">Your Addresses</li>
            </ol>
        </nav>

        <h2>Your Addresses</h2>
        <button class="btn btn-primary mb-3" data-toggle="modal" data-target="#createAddressModal">Add Address</button>

        <table class="table table-striped mt-3">
            <thead>
                <tr>
                    <th>Address Line</th>
                    <th>City</th>
                    <th>Zipcode</th>
                    <th>Country</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for address in addresses %}
                <tr>
                    <td>{{ address.address_line1 }}</td>
                    <td>{{ address.city }}</td>
                    <td>{{ address.zipcode }}</td>
                    <td>{{ address.country }}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="editAddress({{ address.pk }}, '{{ address.address_line1 }}', '{{ address.city }}', '{{ address.zipcode }}', '{{ address.country }}')">Edit</button>
                        <button class="btn btn-danger" onclick="confirmDelete({{ address.pk }})">Delete</button>
                        <button class="btn btn-success" onclick="setActive({{ address.pk }})">Set Active</button>
                        {% if address.is_active %}
                        <span class="badge badge-primary">Active</span>
                        {% else %}
                        <span class="badge badge-danger">Inactive</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Create Address Modal -->
    <div class="modal fade" id="createAddressModal" tabindex="-1" aria-labelledby="createAddressModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createAddressModalLabel">Add Address</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="createAddressForm">
                        <div class="form-group">
                            <label for="address_line1">Address Line 1</label>
                            <input type="text" class="form-control" id="address_line1" required>
                        </div>
                        <div class="form-group">
                            <label for="city">City</label>
                            <input type="text" class="form-control" id="city" required>
                        </div>
                        <div class="form-group">
                            <label for="zipcode">Zipcode</label>
                            <input type="text" class="form-control" id="zipcode" required>
                        </div>
                        <div class="form-group">
                            <label for="country">Country</label>
                            <input type="text" class="form-control" id="country" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Address Modal -->
    <div class="modal fade" id="editAddressModal" tabindex="-1" aria-labelledby="editAddressModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editAddressModalLabel">Edit Address</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="editAddressForm">
                        <input type="hidden" id="edit_address_id">
                        <div class="form-group">
                            <label for="edit_address_line1">Address Line 1</label>
                            <input type="text" class="form-control" id="edit_address_line1" required>
                        </div>
                        <div class="form-group">
                            <label for="edit_city">City</label>
                            <input type="text" class="form-control" id="edit_city" required>
                        </div>
                        <div class="form-group">
                            <label for="edit_zipcode">Zipcode</label>
                            <input type="text" class="form-control" id="edit_zipcode" required>
                        </div>
                        <div class="form-group">
                            <label for="edit_country">Country</label>
                            <input type="text" class="form-control" id="edit_country" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        $('#createAddressForm').on('submit', function (e) {
            e.preventDefault();
            const data = {
                address_line1: $('#address_line1').val(),
                city: $('#city').val(),
                zipcode: $('#zipcode').val(),
                country: $('#country').val(),
                csrfmiddlewaretoken: '{{ csrf_token }}'
            };

            $.post("{% url 'address_create' %}", data)
                .done(function(response) {
                    swal("Success!", response.message, "success").then(() => {
                        location.reload();
                    });
                })
                .fail(function(xhr) {
                    swal("Oops!", xhr.responseJSON.error, "error");
                });
        });

        function confirmDelete(pk) {
            swal({
                title: "Are you sure?",
                text: "Once deleted, you will not be able to recover this address!",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            }).then((willDelete) => {
                if (willDelete) {
                    $.post("{% url 'address_delete' pk=0 %}".replace('0', pk), {
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    })
                    .done(function(response) {
                        swal("Deleted!", response.message, "success").then(() => {
                            location.reload();
                        });
                    })
                    .fail(function(xhr) {
                        swal("Oops!", xhr.responseJSON.error, "error");
                    });
                }
            });
        }

        function editAddress(pk, address_line1, city, zipcode, country) {
            $('#edit_address_id').val(pk);
            $('#edit_address_line1').val(address_line1);
            $('#edit_city').val(city);
            $('#edit_zipcode').val(zipcode);
            $('#edit_country').val(country);
            $('#editAddressModal').modal('show');
        }

        $('#editAddressForm').on('submit', function (e) {
            e.preventDefault();
            const pk = $('#edit_address_id').val();
            const data = {
                address_line1: $('#edit_address_line1').val(),
                city: $('#edit_city').val(),
                zipcode: $('#edit_zipcode').val(),
                country: $('#edit_country').val(),
                csrfmiddlewaretoken: '{{ csrf_token }}'
            };

            $.post("{% url 'address_update' pk=0 %}".replace('0', pk), data)
                .done(function(response) {
                    swal("Success!", response.message, "success").then(() => {
                        location.reload();
                    });
                })
                .fail(function(xhr) {
                    swal("Oops!", xhr.responseJSON.error, "error");
                });
        });



        function setActive(pk) {
            $.post("{% url 'address_set_active' pk=0 %}".replace('0', pk), {
                csrfmiddlewaretoken: '{{ csrf_token }}'
            })
            .done(function(response) {
                swal("Success!", response.message, "success").then(() => {
                    location.reload();
                });
            })
            .fail(function(xhr) {
                swal("Oops!", xhr.responseJSON.error, "error");
            });
        }

    </script>
</body>
</html>